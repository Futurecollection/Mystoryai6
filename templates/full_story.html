{% extends "base.html" %}

{% block content %}
<h1>Full Story So Far</h1>

<div class="p-3 mb-3" style="background: rgba(255,255,255,0.1); white-space: pre-wrap;">
  {% if lines %}
    {% for text in lines %}
      {% if text.startswith('> ') %}
        <div style="margin-bottom: 0.5rem; color: #88ff88;">{{ text }}</div>
      {% else %}
        <div style="margin-bottom: 1.5rem;">
          {{ text }}
          {% with img_key = 'scene_image_' ~ (loop.index0 + 1) %}
          {% if session.get(img_key) %}
          <div class="text-center mb-4 mt-2">
            <img src="{{ session.get(img_key) }}{% if session.get(img_key) and '?' not in session.get(img_key) %}?t={{ range(1000, 9999) | random }}{% endif %}" alt="Scene Image" style="max-width: 60%;">
          </div>
          {% endif %}
          {% endwith %}
        </div>
      {% endif %}
    {% endfor %}
  {% else %}
    <p>(No story narration yet.)</p>
  {% endif %}
</div>

<!-- Form for erotica generation with prompt -->
<form method="POST" action="{{ url_for('generate_erotica') }}" class="mb-3">
  <div class="mb-2">
    <label class="form-label">Custom Instructions (optional):</label>
    <textarea name="erotica_prompt" class="form-control" rows="2" 
              placeholder="E.g.: Make it more romantic, focus on emotional connection, etc."></textarea>
  </div>
  <button type="submit" class="btn btn-danger">Generate Erotica</button>
</form>

<hr>
<a href="{{ url_for('interaction') }}" class="btn btn-secondary">Back to Interaction</a>
{% endblock %}