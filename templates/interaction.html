<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>{{ title }}</title>
</head>
<body>
  <h1>Interaction with NPC</h1>

  <div>
    <p><strong>Affection Score:</strong> {{ affection_score }}</p>
    <p><strong>Trust Score:</strong> {{ trust_score }}</p>
    <p><strong>NPC Mood:</strong> {{ npc_mood }}</p>
    <p><strong>Current Stage:</strong> {{ current_stage }} - {{ stage_label }} ({{ stage_desc }})</p>
    <p><strong>Next Threshold:</strong> {{ next_threshold }}</p>
  </div>

  <hr/>

  <!-- Display the latest narration -->
  <h3>Last Narration</h3>
  <div>
    <p>{{ npc_narration }}</p>
  </div>

  <hr/>

  <!-- Show current scene data (Environment, NPC Action, Lighting) -->
  <h3>Scene State</h3>
  <p><strong>Environment:</strong> {{ environment }}</p>
  <p><strong>NPC Action:</strong> {{ npc_current_action }}</p>
  <p><strong>Lighting Info:</strong> {{ lighting_info }}</p>

  <!-- Form to update the scene if needed -->
  <form method="POST" action="{{ url_for('interaction') }}">
    <input type="hidden" name="update_scene" value="1" />
    <div>
      <label>Update Environment:</label>
      <input type="text" name="environment" value="{{ environment }}" />
    </div>
    <div>
      <label>Update NPC Action:</label>
      <input type="text" name="npc_current_action" value="{{ npc_current_action }}" />
    </div>
    <div>
      <label>Update Lighting:</label>
      <input type="text" name="lighting_info" value="{{ lighting_info }}" />
    </div>
    <button type="submit">Update Scene</button>
  </form>

  <hr/>

  <!-- Interaction log or messages if you want to show them -->
  <h3>Interaction Log</h3>
  <div>
    {% for line in interaction_log %}
      <p>{{ line }}</p>
    {% endfor %}
  </div>

  <hr/>

  <!-- If you want a form for the user to input an action -->
  <form method="POST" action="{{ url_for('interaction') }}">
    <div>
      <label>Your Action:</label>
      <input type="text" name="user_action" placeholder="What do you do or say?" />
    </div>
    <button type="submit" name="submit_action" value="1">Submit Action</button>
  </form>

  <br/>

  <!-- If you want to manually set affection, update stage, etc. -->
  <form method="POST" action="{{ url_for('interaction') }}">
    <label>New Affection Score:</label>
    <input type="text" name="affection_new" placeholder="0.0" />
    <button type="submit" name="update_affection" value="1">Update Affection</button>
  </form>

  <br/>

  <!-- Generate Image Prompt or Image -->
  <form method="POST" action="{{ url_for('interaction') }}">
    <div>
      <label>Scene Image Prompt:</label>
      <input type="text" name="scene_image_prompt" value="{{ scene_image_prompt }}" />
    </div>
    <div>
      <label>Model Type:</label>
      <select name="model_type">
        <option value="flux">Flux</option>
        <option value="pony">Pony SDXL</option>
        <option value="cyberpony">CyberRealisticPony</option>
        <option value="realistic">Realistic Vision</option>
      </select>
    </div>
    <!-- If you have special fields for scheduler or steps -->
    <div>
      <label>Num Steps:</label>
      <input type="text" name="num_steps" value="60" />
    </div>
    <!-- For Cyberpony or Realistic, pick scheduler -->
    <div>
      <label>Cyber/Realistic Scheduler:</label>
      <select name="cyber_scheduler">
        <option value="K_EULER">K_EULER</option>
        <option value="KarrasDPM">KarrasDPM</option>
      </select>
      <select name="realistic_scheduler">
        <option value="EulerA">EulerA</option>
        <option value="MultistepDPM-Solver">MultistepDPM-Solver</option>
      </select>
    </div>

    <button type="submit" name="generate_prompt" value="1">Generate Prompt</button>
    <button type="submit" name="generate_image" value="1">Generate Image</button>
    <button type="submit" name="new_seed" value="1">Generate New Seed</button>
  </form>

  <hr/>

  {% if scene_image_url %}
  <div>
    <h3>Current Scene Image</h3>
    <img src="{{ scene_image_url }}" alt="Scene Image" style="max-width: 400px;">
  </div>
  {% endif %}

  <br/>
  <p><a href="{{ url_for('main_home') }}">Back to Home</a></p>
</body>
</html>