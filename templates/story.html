{% extends "base.html" %}
{% block content %}
<h1>Story</h1>
<div class="border p-3 mb-3 bg-light" style="white-space: pre-line;">{{ scene_text }}</div>

<h3>What do you do (if anything)?</h3>

<form method="POST" class="mb-4">
  <label class="form-label">Type your action (optional):</label>
  <input type="text" class="form-control mb-2" name="user_action" placeholder="e.g. 'He quietly asks about her day...'">
  <button type="submit" name="action_custom" value="true" class="btn btn-success">
    Submit Action
  </button>
</form>

<hr>
<h3>Image Prompt</h3>
<form method="POST">
  <textarea name="scene_image_prompt" rows="3" class="form-control">{{ scene_image_prompt }}</textarea>
  <div class="mt-3">
    <button type="submit" name="generate_scene_image" value="true" class="btn btn-primary me-2">
      Generate Scene Image
    </button>
  </div>
</form>

{% if scene_image_generated %}
  <hr>
  <h4>Generated Scene Image</h4>
  <img src="{{ url_for('view_image') }}" alt="Scene Image" style="max-width: 60%;">
  <p class="mt-2">Seed: {{ seed_used }}</p>
  <form method="POST">
    <button type="submit" name="regen_scene_same_seed" value="true" class="btn btn-secondary me-2">
      Regenerate (Same Seed)
    </button>
    <button type="submit" name="regen_scene_new_seed" value="true" class="btn btn-warning">
      Regenerate (New Seed)
    </button>
  </form>
{% endif %}

<hr>
<form method="POST" style="display:inline;">
  <button type="submit" name="go_back" value="true" class="btn btn-outline-danger me-2">Back</button>
</form>
<a href="{{ url_for('restart') }}" class="btn btn-outline-secondary">Restart Entire Story</a>

<hr>
<div class="mt-4 p-2 bg-warning">
  <h5>DEBUG Relationship Stats (for testing):</h5>
  <ul>
    <li>Affection Score: {{ affection_score }}</li>
    <li>Trust Score: {{ trust_score }}</li>
    <li>NPC Mood: {{ npc_mood }}</li>
    <li>Current Stage: {{ current_stage }} ({{ stage_label }})</li>
    <li>Stage Description: {{ stage_desc }}</li>
    <li>Next Stage Threshold: {{ next_threshold }}</li>
    <li>NPC Private Thoughts: {{ npc_private_thoughts }}</li>
  </ul>
</div>

{% endblock %}