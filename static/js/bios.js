// Character biographies for the pre-made options
const characterBios = {
  "emma": {
    "name": "Emma Chen",
    "gender": "Female",
    "age": "28",
    "ethnicity": "Chinese American",
    "sexual_orientation": "Straight",
    "relationship_goal": "Serious Relationship",
    "body_type": "Athletic",
    "hair_color": "Black",
    "hair_style": "Long and Straight",
    "clothing": "Business Casual - Blazer",
    "personality": "Confident and Outgoing",
    "occupation": "Tech CEO",
    "current_situation": "Career-focused",
    "environment": "Upscale Restaurant",
    "encounter_context": "Professional Consultation",
    "bio": "# Emma Chen\n\nEmma Chen is a 28-year-old tech CEO who has taken Silicon Valley by storm with her innovative AI startup. With her confident demeanor and sharp intelligence, she commands respect in every room she enters.\n\n## Personal Information\n- Age: 28\n- Birthplace: San Francisco, California\n- Education: Stanford University (Computer Science)\n- Current Residence: Modern penthouse apartment in San Francisco\n\n## Background & History\nBorn to immigrant parents who worked in tech, Emma was coding by age 10. She founded her first startup at 22 right after graduating Stanford, and after a successful acquisition, launched her current company which focuses on ethical AI solutions. Her meteoric rise earned her a spot on Forbes 30 Under 30 last year.\n\n## Personality\nEmma is confident, ambitious, and decisive in her professional life, but those who get close discover her playful, adventurous side. She has a quick wit and enjoys intellectual sparring. While she appears completely self-assured in public, she occasionally questions if she's missing out on deeper personal connections due to her intense focus on her career.\n\n## Current Life\nAs CEO of TechFusion AI, Emma works long hours but makes time for tennis, hiking, and occasional weekend getaways. She's recently started to prioritize more work-life balance after realizing success feels incomplete without someone to share it with. Her daily routine includes early morning workouts, back-to-back meetings, and late nights reviewing code or strategy documents.\n\n## Appearance\nEmma has long, straight black hair that she often wears in a sleek ponytail for work. She's athletic from her regular tennis matches and morning runs. Her wardrobe consists primarily of tailored blazers, designer dresses, and the occasional tech company hoodie when working late. She carries herself with poise and maintains excellent posture—a habit from her childhood dance lessons.\n\n## Interests & Hobbies\n- Competitive tennis\n- Mountain hiking\n- Fine wine tasting\n- Reading biographies of innovative leaders\n- Attending symphony performances\n\n## Relationship Status\nEmma has been single for the past two years, with her last relationship ending when her ex-boyfriend couldn't understand her dedication to her company. Meeting you has caught her interest—she's intrigued by someone who seems to understand both her drive and her desire for connection beyond the boardroom."
  },
  "scarlett": {
    "name": "Scarlett Winters",
    "gender": "Female",
    "age": "32",
    "ethnicity": "Caucasian",
    "sexual_orientation": "Bisexual",
    "relationship_goal": "Taking Things Slow",
    "body_type": "Hourglass Figure",
    "hair_color": "Red",
    "hair_style": "Long and Wavy",
    "clothing": "Cocktail Dress",
    "personality": "Mysterious and Intriguing",
    "occupation": "Actress",
    "current_situation": "Between Projects",
    "environment": "Hotel Lobby",
    "encounter_context": "Chance Meeting While Traveling",
    "bio": "# Scarlett Winters\n\nScarlett Winters is an acclaimed 32-year-old actress known for her versatile performances and captivating screen presence. With fiery red hair and an enigmatic personality, she brings an air of mystery to every encounter.\n\n## Personal Information\n- Age: 32\n- Birthplace: Boston, Massachusetts\n- Education: Juilliard School of Drama\n- Current Residence: West Hollywood home and various temporary locations while filming\n\n## Background & History\nScarlett began her career in theater before transitioning to independent films where she gained critical acclaim. Her breakthrough role in the psychological thriller \"Crimson Shadows\" earned her an Academy Award nomination and catapulted her to fame. Despite her success, she's maintained a relatively private personal life, appearing selectively at industry events and avoiding the typical Hollywood party scene.\n\n## Personality\nScarlett possesses a captivating combination of confidence and vulnerability. She's thoughtful and observant, often preferring to listen before speaking. Her mysterious aura isn't an act—she genuinely values depth and authenticity in relationships. While she can charm a room when necessary, she's most comfortable in intimate conversations where she can be her unguarded self.\n\n## Current Life\nCurrently between film projects, Scarlett is taking time to travel and read scripts that challenge her artistically. She's grown somewhat weary of the superficial aspects of Hollywood and finds herself seeking more meaningful connections. Her schedule alternates between intensely busy filming periods and breaks where she can pursue other interests and reconnect with herself.\n\n## Appearance\nScarlett has naturally wavy red hair that falls past her shoulders, pale skin with a few freckles, and expressive green eyes. Her hourglass figure is the result of both genetics and the dance training she maintains for film roles. Her style is elegant with a vintage flair—she often wears classic silhouettes that evoke old Hollywood glamour.\n\n## Interests & Hobbies\n- Film history and classic cinema\n- Photography (analog film cameras)\n- Ballet and contemporary dance\n- Collecting first-edition books\n- International travel to locations off the tourist path\n\n## Relationship Status\nScarlett has had several high-profile relationships that ended due to the challenges of her career and the public scrutiny they faced. She's been single for almost a year, taking time to rediscover what she truly wants in a partner. Meeting you has sparked her interest—she appreciates that you seem to see beyond her public persona and connect with the woman behind the roles she plays."
  },
  "zendaya": {
    "name": "Zara Malik",
    "gender": "Female",
    "age": "26",
    "ethnicity": "Mixed Race",
    "sexual_orientation": "Straight",
    "relationship_goal": "Open to Anything",
    "body_type": "Slender",
    "hair_color": "Black",
    "hair_style": "Natural Curls",
    "clothing": "Avant-garde Fashion",
    "personality": "Creative and Artistic",
    "occupation": "Fashion Designer",
    "current_situation": "Career Transition",
    "environment": "Art Gallery Opening",
    "encounter_context": "Shared Hobby/Class",
    "bio": "# Zara Malik\n\nZara Malik is a 26-year-old rising fashion designer known for her bold, culturally-infused designs that challenge industry norms. With her natural confidence and artistic vision, she's becoming a notable name in the fashion world.\n\n## Personal Information\n- Age: 26\n- Birthplace: London, England\n- Education: Central Saint Martins (Fashion Design)\n- Current Residence: Converted industrial loft in New York's fashion district\n\n## Background & History\nBorn to a British mother and Pakistani father, Zara grew up with influences from both cultures. She showed artistic talent early, redesigning her clothes since childhood. After graduating from one of London's prestigious fashion schools, she worked for major design houses before launching her independent label last year. Her debut collection received significant attention for its innovative approach to sustainable luxury.\n\n## Personality\nZara is creative, passionate, and unapologetically authentic. She has a natural warmth that draws people in, coupled with a determination that helps her overcome industry challenges. While confident in her artistic vision, she sometimes struggles with the business aspects of her career. She's reflective and empathetic, often finding inspiration in the stories and struggles of others.\n\n## Current Life\nCurrently in a career transition, Zara is expanding her brand from custom designs to a limited ready-to-wear collection. She divides her time between her studio, sourcing ethical materials, and networking events. She's working toward her first major Fashion Week presentation while navigating the challenges of being an independent designer in a competitive industry.\n\n## Appearance\nZara has a slender, graceful frame and moves with natural elegance. Her black hair falls in natural curls that she proudly wears as a statement against fashion's often Eurocentric beauty standards. Her warm brown skin glows from her disciplined skincare routine. Her personal style is a perfect example of her design philosophy—unexpected combinations of structural elements with flowing fabrics, often incorporating subtle nods to her South Asian heritage.\n\n## Interests & Hobbies\n- Textile art and fabric dyeing techniques\n- Cultural anthropology and costume history\n- Street photography for design inspiration\n- Yoga and meditation\n- Cooking fusion dishes that blend her dual heritage\n\n## Relationship Status\nZara's intense focus on launching her brand has left little time for serious relationships in recent years. She's had a few short-term connections but found they often couldn't understand her unpredictable schedule and creative process. Upon meeting you, she's intrigued by your perspective and the easy conversation between you—a welcome respite from the transactional relationships common in her industry."
  },
  "natalie": {
    "name": "Natalia Petrova",
    "gender": "Female",
    "age": "34",
    "ethnicity": "Russian",
    "sexual_orientation": "Straight",
    "relationship_goal": "Serious Relationship",
    "body_type": "Athletic",
    "hair_color": "Dark Brown",
    "hair_style": "Medium Length",
    "clothing": "Smart Casual",
    "personality": "Intellectual and Analytical",
    "occupation": "International Journalist",
    "current_situation": "Recently Moved",
    "environment": "Cozy Bookstore Cafe",
    "encounter_context": "Chance Meeting",
    "bio": "# Natalia Petrova\n\nNatalia Petrova is a 34-year-old international journalist known for her insightful coverage of global politics and humanitarian issues. With her sharp intellect and worldly perspective, she brings depth and nuance to every conversation.\n\n## Personal Information\n- Age: 34\n- Birthplace: St. Petersburg, Russia\n- Education: Moscow State University (Political Science), Columbia School of Journalism\n- Current Residence: Recently settled apartment in your city after years abroad\n\n## Background & History\nNatalia grew up in post-Soviet Russia, which sparked her interest in political systems and social change. After studying in Moscow and New York, she built her career reporting from conflict zones and political hotspots across Eastern Europe, the Middle East, and Africa. Her award-winning coverage of refugee crises has been featured in major international publications. After ten years of constant travel, she's recently accepted a position that allows her to be based in one location while still covering international stories.\n\n## Personality\nNatalia is thoughtful, analytical, and deeply empathetic despite her sometimes reserved exterior. Years of journalism have made her an excellent listener with an ability to ask just the right questions. She has a dry wit that emerges once she's comfortable. While intellectually confident, she can be more guarded with her emotions—a protective habit developed from witnessing human vulnerability in difficult circumstances around the world.\n\n## Current Life\nHaving recently moved to establish a more permanent home base, Natalia is adjusting to a less nomadic lifestyle. She still travels for important stories but is learning to appreciate routine and community. She's setting up her apartment, exploring local haunts, and embracing small pleasures that weren't possible during her constantly mobile years. Her work remains demanding, often involving late nights researching or conducting interviews across time zones.\n\n## Appearance\nNatalia has an athletic build from years of navigating challenging terrain on assignment and maintaining running as her constant across different countries. Her dark brown hair falls to her shoulders, often tucked behind her ears when she's concentrating. Her hazel eyes reflect both intensity and warmth. Her style is practical but elegant—well-crafted basics that travel well, with the occasional statement piece collected from her global assignments.\n\n## Interests & Hobbies\n- Political literature and international relations theory\n- Documentary photography\n- Distance running\n- Languages (fluent in Russian, English, and Arabic; conversational in French)\n- Exploring local markets and food cultures\n\n## Relationship Status\nNatalia's career has made long-term relationships challenging. Her last serious relationship ended two years ago when the geographic distance became unsustainable. Now that she's establishing a more stable base, she's cautiously open to building a meaningful connection. Meeting you has caught her interest—she appreciates your perspective and finds herself curious to learn more about your life and experiences."
  },
  "henry": {
    "name": "Henry Fielding",
    "gender": "Male",
    "age": "31",
    "ethnicity": "Black/African American",
    "sexual_orientation": "Straight",
    "relationship_goal": "Serious Relationship",
    "body_type": "Athletic",
    "hair_color": "Black",
    "hair_style": "Short and Styled",
    "clothing": "Smart Casual",
    "personality": "Confident and Outgoing",
    "occupation": "Fitness Entrepreneur",
    "current_situation": "Business Expansion",
    "environment": "Upscale Gym",
    "encounter_context": "Fitness Class",
    "bio": "# Henry Fielding\n\nHenry Fielding is a 31-year-old fitness entrepreneur who has successfully transformed his passion for wellness into a growing business empire. With his magnetic personality and genuine desire to help others, he inspires everyone around him.\n\n## Personal Information\n- Age: 31\n- Birthplace: Philadelphia, Pennsylvania\n- Education: Penn State University (Business Administration with minor in Nutrition Science)\n- Current Residence: Modern condo in the city's vibrant downtown district\n\n## Background & History\nRaised by parents who emphasized both education and athletics, Henry excelled in college sports while building a strong academic foundation. After graduation, he rejected corporate job offers to pursue his passion, starting as a personal trainer. Five years ago, he launched his own boutique fitness studio combining high-intensity training with holistic wellness approaches. His innovative concept quickly gained popularity, and he's now preparing to open his third location while expanding his branded supplement line.\n\n## Personality\nHenry is naturally charismatic, exuding confidence that never crosses into arrogance. He's genuinely interested in people and remembers small details about everyone he meets. His infectious enthusiasm and positive outlook make challenges seem conquerable. While he presents a strong, motivated exterior, close friends know he sometimes questions whether his success is meaningful enough beyond the commercial aspects.\n\n## Current Life\nCurrently focused on expanding his fitness brand, Henry balances hands-on training with the growing business responsibilities of his enterprise. He starts each day with his own workout before dawn, then divides time between client sessions, business development, and community outreach programs he's passionate about. Despite his busy schedule, he's making a conscious effort to create space for personal relationships after realizing business success alone doesn't provide complete fulfillment.\n\n## Appearance\nHenry has an athletic, well-maintained physique that reflects his commitment to fitness as both profession and lifestyle. His short black hair is always perfectly styled, complementing his well-groomed appearance. His wardrobe consists of tailored casual wear that transitions easily from business meetings to training sessions. His most striking feature is his genuine smile that immediately puts people at ease.\n\n## Interests & Hobbies\n- Rock climbing and outdoor adventure sports\n- Reading business and personal development books\n- Cooking nutritious, innovative meals\n- Mentoring youth from underserved communities\n- Jazz music and occasional saxophone playing (a childhood hobby he's rekindling)\n\n## Relationship Status\nHenry has had several relationships that ended due to his demanding schedule and single-minded focus on building his business. After two years of casual dating, he's realized he wants something more meaningful and is ready to make space for the right person. Meeting you has sparked his interest—he appreciates your energy and perspective, finding himself thinking about you even during his normally focused workday."
  },
  "chris": {
    "name": "Christopher Reynolds",
    "gender": "Male",
    "age": "35",
    "ethnicity": "British",
    "sexual_orientation": "Straight",
    "relationship_goal": "Taking Things Slow",
    "body_type": "Athletic",
    "hair_color": "Dark Blonde",
    "hair_style": "Medium Length",
    "clothing": "Casual - Henley & Jeans",
    "personality": "Thoughtful and Analytical",
    "occupation": "Marine Biologist",
    "current_situation": "Research Project",
    "environment": "Oceanfront Research Center",
    "encounter_context": "Chance Meeting",
    "bio": "# Christopher Reynolds\n\nChristopher (Chris) Reynolds is a 35-year-old marine biologist whose work studying ocean ecosystems has taken him to the world's most remote coastlines. With his thoughtful demeanor and passion for conservation, he brings depth and purpose to his interactions.\n\n## Personal Information\n- Age: 35\n- Birthplace: Brighton, England\n- Education: University of Southampton (Marine Biology), Ph.D. from Scripps Institution of Oceanography\n- Current Residence: Coastal cottage near his current research station\n\n## Background & History\nChris grew up along the English coastline, developing an early fascination with marine life. After completing his education with honors, he built his reputation through groundbreaking research on coral reef restoration. He's spent the last decade leading international conservation projects, with his work featured in prestigious scientific journals and environmental documentaries. Recently, he received a major grant to head a three-year study on sustainable coastal ecosystems.\n\n## Personality\nChris is thoughtful and analytical, often taking time to process before speaking. This contemplative nature masks a passionate commitment to his work and deeply held values. He has a subtle, intelligent humor that emerges when he's comfortable. While he can command attention when presenting his research, he's naturally more reserved in social settings, preferring meaningful conversation to small talk.\n\n## Current Life\nCurrently leading a significant research project, Chris divides his time between field work, laboratory analysis, and writing. His typical day might include diving to collect samples, working with his research team, or collaborating with local conservation groups. After years of constant travel, he's appreciating the relative stability of his current project location, which allows him to develop relationships beyond his professional circle.\n\n## Appearance\nChris has an athletic build maintained by regular swimming and diving. His medium-length dark blonde hair often appears lighter from sun exposure, and he typically wears it casually styled or pushed back when working. His tan reflects countless hours spent outdoors, and fine lines around his eyes speak to years squinting at the ocean horizon. His style is practical and unfussy—quality basics that transition well from research stations to casual meetings.\n\n## Interests & Hobbies\n- Underwater photography\n- Sailing and kayaking\n- Environmental literature and philosophy\n- Acoustic guitar playing\n- Collecting rare books on maritime history\n\n## Relationship Status\nChris's demanding career and frequent relocations have made sustaining relationships challenging. His last serious relationship ended amicably two years ago when their career paths diverged to different continents. He's been focused on his work since then, but his more settled position has him open to connection again. Meeting you has genuinely caught his interest—he finds your perspective refreshing and feels an unexpected ease in your company that has him reconsidering his solitary habits."
  }
};

// Function to update the bio text area when a predefined bio is selected
function updateBioText() {
  const bioSelect = document.getElementById('predefinedBios');
  const bioTextArea = document.getElementById('bioTextArea');
  const bioText = document.getElementById('bioText');
  const bioPreview = document.getElementById('bioPreview');
  
  if (!bioSelect || !bioTextArea || !bioText) return;
  
  const selectedBio = bioSelect.value;
  
  if (selectedBio && characterBios[selectedBio]) {
    const bio = characterBios[selectedBio];
    
    // Set the text in the textarea and hidden input
    bioTextArea.value = bio.bio;
    bioText.value = bio.bio;
    
    // Update the preview div
    if (bioPreview) {
      bioPreview.textContent = bio.bio;
    }
    
    // Make sure the premade bio section is visible
    const premadeBioSection = document.getElementById('premadeBioSection');
    if (premadeBioSection) {
      premadeBioSection.style.display = 'block';
    }
    
    // Auto-fill the form fields based on the selected bio
    fillFormFields(selectedBio);
  } else {
    bioTextArea.value = '';
    bioText.value = '';
    if (bioPreview) {
      bioPreview.textContent = '';
    }
  }
}

// Function to fill form fields based on the selected bio
function fillFormFields(bioKey) {
  const character = characterBios[bioKey];
  if (!character) return;

  // Get all the form elements we need to fill
  const formFields = {
    // NPC basic info
    "npc_name": character.name,
    "npc_gender": character.gender,
    "npc_age": character.age,
    "npc_ethnicity": character.ethnicity,
    "npc_sexual_orientation": character.sexual_orientation,
    "npc_relationship_goal": character.relationship_goal,

    // Appearance
    "npc_body_type": character.body_type,
    "npc_hair_color": character.hair_color,
    "npc_hair_style": character.hair_style,
    "npc_clothing": character.clothing,

    // Personality & Situation
    "npc_personality": character.personality,
    "npc_occupation": character.occupation,
    "npc_current_situation": character.current_situation,

    // Environment
    "environment": character.environment,
    "encounter_context": character.encounter_context
  };

  // Fill dropdown fields
  for (const fieldName in formFields) {
    const value = formFields[fieldName];
    if (!value) continue;

    // First try to set the dropdown value
    const dropdown = document.querySelector(`select[name="${fieldName}"]`);
    if (dropdown) {
      // Look for an exact match first
      let matchFound = false;
      for (let i = 0; i < dropdown.options.length; i++) {
        if (dropdown.options[i].value === value) {
          dropdown.selectedIndex = i;
          matchFound = true;
          break;
        }
      }

      // If no exact match, try a partial match (case insensitive)
      if (!matchFound) {
        const lowerValue = value.toLowerCase();
        for (let i = 0; i < dropdown.options.length; i++) {
          if (dropdown.options[i].value.toLowerCase().includes(lowerValue)) {
            dropdown.selectedIndex = i;
            matchFound = true;
            break;
          }
        }
      }

      // If still no match, use the custom field
      if (!matchFound) {
        const customField = document.querySelector(`input[name="${fieldName}_custom"]`);
        if (customField) {
          customField.value = value;
        }
      }
    } else {
      // If dropdown not found, try direct input field
      const inputField = document.querySelector(`input[name="${fieldName}"]`);
      if (inputField) {
        inputField.value = value;
      }

      // Also check for custom fields
      const customField = document.querySelector(`input[name="${fieldName}_custom"]`);
      if (customField) {
        customField.value = value;
      }
    }
  }
}

// Function to show the premade bio section
function showPremadeBio() {
  document.getElementById('premadeBioSection').style.display = 'block';
  document.getElementById('manualCustomizationSection').style.display = 'none';

  // Ensure the textarea shows the currently selected bio
  updateBioText();
}

// Function to show the manual customization section
function showManualCustomization() {
  document.getElementById('premadeBioSection').style.display = 'none';
  document.getElementById('manualCustomizationSection').style.display = 'block';
}

// Initialize when the document loads
document.addEventListener('DOMContentLoaded', function() {
    // Set up event listener for the bio selection
    const bioSelect = document.getElementById('predefinedBios');
    if (bioSelect) {
        bioSelect.addEventListener('change', updateBioText);
    }
    
    // Set up event listener for the textarea to update the hidden input
    const bioTextArea = document.getElementById('bioTextArea');
    const bioText = document.getElementById('bioText');
    if (bioTextArea && bioText) {
        bioTextArea.addEventListener('input', function() {
            bioText.value = bioTextArea.value;
        });
    }
});